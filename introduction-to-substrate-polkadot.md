# Substrate 和 Polkadot
## Substrate 介绍
* Substrate 是 Parity 创建的下一代通用的区块链框架，可升级、高效率、创新性
* 许可证
  * Substrate 原语 (sp-*)、框架 (frame-*)、调色板 (pallets-*)、二进制文件 (/bin) 和其它实用工具使用 Apache 2.0 许可证
  * Substrate 客户端 (/client/* / sc-*) 使用 GPL v3.0 许可证，但类路径链接例外
* Substrate 可以帮助我们开发出最好的区块链
* 我们可以基于 Substrate 轻松的开发出可升级、高效率、创新性的区块链项目

## Substrate 特性——可升级
* 升级方案
  * 传统区块链项目，每次重大升级都需要硬分叉或者软分叉（如：比特币现金的硬分叉、比特币 SegWit 隔离见证，以太坊君士坦丁堡硬分叉、圣彼得堡硬分叉），每次分叉都有可能造成永久性的分叉
  * 但是又不能不分叉，新功能考虑兼容旧的节点，不可避免造成代码臃肿，无法快速迭代
  * 很多新的区块链项目都有每半年左右执行一次硬分叉的需求，方便新功能的发布。不需要考虑兼容旧的节点，节点经常更新升级，在安全方面是好事，在运营方面是挑战
  * Substrate 提供了一个更好的、不需要分叉的升级方案
* Substrate 节点是三部分组成
  * Runtime，包括了所有链上的逻辑。Substrate 用 FRAME 框架构建区块链的 Runtime。开发者可以自定义的模块，即调色板。调色板通过 `construct_runtime` 宏组合成一个运行时。
  * Pallents，项目中的 Runtime 是由多个 FRAME 调色板构建的，里面也定义了一个模版
  * Node，允许用户参与区块链网络，包括了如下功能：允许节点用 libp2p 网络进行通信、通过共识机制就网络状态达成共识、远程过程调用（RPC）服务器用于和Substrate 节点进行交互
* 可动态升级 Runtime 是怎么实现的
  * runtime 是一堆 Rust 语言代码，通过 rustc 编译成 Runtime 的 wasm 二进制文件
  * 通过链上自治模块，发送一个治理模块升级 Runtime 的消息，带着 wasm 二进制文件存到链上，由治理模块判断是否执行升级。私有链就比较简单，只要拥有一个最高权限的私钥就可以升级 runtime；公链的话就会有复杂的机制（治理模块），一般会进行投票一类的动作，直到大家达成共识，说这个 runtime 是合法的，然后就可以升级 
  * 如果升级成功，节点会同步最新的区块，同步了包含最新 Runtime 的区块，就从链上取得了 wasm 二进制文件，然后在下一个区块，就会使用 WebAssebly 解释器，来执行最新的 Runtime，执行最新的链上逻辑，这样就完成了无缝升级，所有的节点都在规定的区块进行升级，而不用担心部分节点没有升级造成稳定性和安全性的问题。因为就算节点是使用旧版本的，但是执行的 Runtime wasm 是从链上取得的最新版本，保证所有节点共识的一致性。

## Substrate 特性——高效率
* Substrate 的设计从各个角度都是以最高的执行效率为出发点
  * Rust 语言的选择，可以在保证内存安全的同时拥有最大自由度和优化的可能性，内存安全，避免由于内存溢出而导致的安全隐患，无 GC 避免了垃圾回收造成的性能问题，Rust 强大的强类型系统，编译时就可以阻止大量的常见错误，大大提高了程序安全性，安全性是区块链必需的，所以 Rust 是最适合开发区块链的语言
  * 内置的 PoS 共识机制，只需要验证人节点，就可以高效出块，避免了不必要的挖矿，实现 TPS 的最大化，不挖矿，大大降低了运营的硬件成本
  * 轻节点，高效率、轻量级、去中心化、去信任化的方式，验证区块头和链上数据，这样使移动端、物联网端、和网页端具备轻节点实现的可能性
* PoS 和 PoW
  * POS 是不需要挖矿的，只需要有验证人节点就可以高效率的出块
  * PoW 从根本上是不可能有快速确认的可能的，就像以太坊目前的平均出块时间是 15 秒，一般需要 12 个以上区块的确认，这样的话最终确认时间是 3 分钟左右。就算平均出块时间从 15 秒降到 10 秒或者 5 秒，这样确认数量会有相对应的增加，结果就是最终确认时间还是需要好几分钟
  * PoS 则不会有这个问题，有更快的出块时间，现在 Polkadot 平均出块时间是 6s，一般 2～3 个块就可以最终确认，所以大概 18s 以内可以最终确认。Substrate 的出块时间可以配置，一般配置 2～6 秒钟，2～3 个块就可以最终确认，所以一般 10 秒钟就可以最终确认。
* 共识机制和 Trie DB (Patricia Merkle Tree) 设计
  * 保证了轻节点，可以高效率，轻量级，去中心化，去信任化的方式，只下载区块头和一部分 stack 上的数据，通过 PMT 验证区块头是否合法，不是伪造的。
  * 这样使得移动端，物联网端，和浏览器端的轻节点实现的可能性
  * 这样就比如说，手机钱包，可以成为一个轻节点，验证链上的用户交易的数据。而一个全节点是没有能力伪造数据来欺骗轻节点的。这样这个手机钱包就不需要无条件相信连接的全节点，避免了双花的可能性，保证了用户的资金安全（独立验证交易的合法性、独立验证区块头的合法性、独立验证这笔交易是否事成功的、独立验证用户的金额是否是这个数字）

## Substrate 特性——创新性，可以用它开发出任何想要开发的区块链，可以用它开发出最好的区块链
* 抽象的模块化结构
  * 定制模块，所有的模块都是可定制的，其中包括但不限于：共识机制，Balance 代币模块，Governance 自治管理模块，p2p 网络层，地址格式，Transaction 交易格式、区块头包含的数据等等
  * 删减不需要的模块，添加需要的模块
  * 自己开发和添加独有的模块
* 使用 WebAssembly 解释器（执行引擎），保证了 Runtime 的可升级性，同时也可以实现智能合约
  * 不同的开发语言的自由选择 （Rust，C++ 和 Go 语言的 Polkadot Runtime Environment 实现中）
  * 任意可以编译成 wasm 的第三方库都可以使用，比如：基于 Substrate 开发的利用 zkSNARKs 实现的隐私链
  * 强大的智能合约系统，与链上内置的模块交互，扩张链的功能

## Substrate 特性总结
* 可升级，所以避免（或解决）了硬分叉的需求，保证快速迭代
* 高效率，所以保证了 TPS 的最大化和轻节点的可能性
* 创新性，所以可以用它开发出任何想要的区块链，可以用它开发出最好的区块链，只有你想不到的，没有不能通过 Substrate 实现的

## 波卡生态圈
* 波卡是 Parity 是基于 Substrate 开发的下一代区块链项目
* Polkadot PoC 2 是 Substrate 的前身
* 波卡链本身是一个中继链，其目标是为了实现跨链沟通
* 波卡链支持私有链、公链、oracles 预言机之间去信任化的交流
* 波卡生态圈包含了 relay chain 中继链，parachain 平行链，bridges 跨链桥接
  * Relay chain 中继链的作用是达成关于平行链和中继链状态的共识
    * 在中继链上，可以查询、确认与它相连的平行链上的状态
    * 在平行链上，同样可以查询与它相连的中继链上的状态
    * 这些状态必需保持一致，就是所谓的共识
    * 中继链拥有自己独立的验证人节点，保证中继链的安全性，不会有双花的可能
  * Parachain 平行链是独立的区块链，拥有自己独立的链上数据和交易处理，但同时利用了中继链来保证安全性
    * 平行链拥有自己独立的出块逻辑，但是它出的块只有在中继链上确认的时候，才是真正确认的
    * 这样解决了传统区块链项目扩展性的问题
    * CryptoKitties 加密猫曾经造成了以太坊严重堵塞的问题，这对于其他以太坊的用户非常不公平
    * 但如果加密猫是一个 parachain 平行链的话，那这条链的使用度是不会对中继链和其他平行链造成任何影响的
  * Bridges 跨链桥接，让波卡生态圈能够与其他原先不在波卡生态圈中得的独立链进行交流，比如比特币和以太坊
    * 让波卡生态圈成为一个开发的生态圈
    * 不仅可以与 Substrate 开发的链交流，还可以与其它的区块链交流

## Polkadot 波卡生态圈总结
* Polkadot 波卡生态圈是可以实现真正的去中心化的互联网生态圈
* Relay chain 中继链让跨链交流成为可能
* Parachain 平行链实现业务逻辑，一般平行链都是通过 Substrate 创建
* Bridges 跨链桥接让其它链也能够加入波卡生态圈，成为一个开放的生态圈

